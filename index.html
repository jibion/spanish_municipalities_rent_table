<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.5.1.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="./css/datatables.min.css">
    <script type="text/javascript" charset="utf8" src="./js/datatables.min.js"></script>

    <style type="text/css">
        html,
        body,
        #container {
            width: 100%;
            height: 100%;
            margin: 0 auto;
            padding: 0;
        }
    </style>

    <script type="text/javascript" language="javascript" class="init">
        $(document).ready(function () {
            $.ajax({
                url: "./data/data_vc.json",
                success: function (data, type, full) {
                    var o = data;
                    $('#table_id').dataTable({
                        initComplete: function () {
            this.api()
                .columns([1, 2])
                .every(function () {
                    var column = this;
                    var select = $('<select><option value=""></option></select>')
                        .appendTo($(column.footer()).empty())
                        .on('change', function () {
                            var val = $.fn.dataTable.util.escapeRegex($(this).val());
 
                            column.search(val ? '^' + val + '$' : '', true, false).draw();
                        });
 
                    column
                        .data()
                        .unique()
                        .sort()
                        .each(function (d, j) {
                            select.append('<option value="' + d + '">' + d + '</option>');
                        });
                });
        },
                        responsive: true,
                        language: {
                            url: './i18n/es_ES.json',
                            decimal: ',',
                            thousands: '.',
                        }, // Sort by columns 1 and 2 and redraw
                        order: [[3, 'desc']],
                        data: o,
                        columns: [
                            { "data": "municipio" },
                            { "data": "provincia" },
                            { "data": "ca" },
                            {
                                "data": "n_alquileres_2020",
                                render: $.fn.dataTable.render.number(".", ",", 0, null, null)
                            },
                            {
                                "data": "rent_m2_median_2020",
                                render: $.fn.dataTable.render.number(".", ",", 2, null, ' €')
                            },
                            {
                                "data": "rent_total_median_2020",
                                render: $.fn.dataTable.render.number(".", ",", 0, null, ' €')
                            },
                            {
                                "data": "rent_size_median_2020",
                                render: $.fn.dataTable.render.number(".", ",", 0, null, ' m<sup>2</sup>')
                            },
                            {
                                "data": "p_alquileres_provincia_2020",
                                render: function (data, type, row) {
                                    return (row.p_alquileres_provincia_2020 * 100).toFixed(2) + ' %';
                                }
                            },
                            {
                                "data": "p_alquileres_comunidad_2020",
                                render: function (data, type, row) {
                                    return (row.p_alquileres_comunidad_2020 * 100).toFixed(2) + ' %';
                                }
                            },
                            {
                                "data": "diff_rent_sqm_median_provincia_2020",
                                render: function (data, type, row) {
                                    return (row.diff_rent_sqm_median_provincia_2020 * 100).toFixed(2) + ' %';
                                }
                            },
                            {
                                "data": "diff_rent_m2_median_2019",
                                render: function (data, type, row) {
                                    return (row.diff_rent_m2_median_2019 * 100).toFixed(2) + ' %';
                                }
                            }
                        ],
                        columnDefs: [
                            { responsivePriority: 1, targets: 0 },
                            { responsivePriority: 2, targets: 4 },
                            { responsivePriority: 3, targets: 1 },
                            { responsivePriority: 4, targets: 2 }
                        ]
                    });
                }
            });
        });


    </script>
</head>

<body class="dt-example">
    <table id="table_id" class="display responsive nowrap" style="width:100%">
        <thead>
            <tr>
                <th>Municipio</th>
                <th>Provincia</th>
                <th>Comunidad Autonoma</th>
                <th class="none"># Alquileres:</th>
                <th>Precio medio m<sup>2</sup> alquiler</th>
                <th>Precio medio mensual alquiler</th>
                <th>Superficie en m<sup>2</sup> media</th>
                <th class="none">% Alquileres toda la provincia:</th>
                <th class="none">% Alquileres toda la comunidad autonoma:</th>
                <th class="none">% Diferencia con la media provincial:</th>
                <th class="none">% Diferencia con la media de 2019:</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
            <tr>
                <td>Municipio</td>
                <td>Provincia</td>
                <td>Comunidad Autonoma</td>
                <td class="none"># Alquileres:</td>
                <td>Precio medio m<sup>2</sup> alquiler</td>
                <td>Precio medio mensual alquiler</td>
                <td>Superficie en m<sup>2</sup> media</td>
                <td class="none">% Alquileres toda la provincia:</td>
                <td class="none">% Alquileres toda la comunidad autonoma:</td>
                <td class="none">% Diferencia con la media provincial:</td>
                <td class="none">% Diferencia con la media de 2019:</td>
            </tr>
        </tfoot>
    </table>
</body>

</html>